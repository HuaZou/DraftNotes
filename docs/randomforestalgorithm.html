<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 15 Random Forest Algorithm | 生物信息随记</title>
<meta name="author" content="Hua Zou">
<meta name="description" content="随机森林是常用的非线性用于构建分类器的算法，它是由数目众多的弱决策树构建成森林进而对结果进行投票判断标签的方法。随机森林用于分类器的算法过程， 随机切分样本，然后选择2/3用于建模，剩余1/3用于验证袋外误差； 随机选择特征构建决策树，每个叶子节点分成二类； 根据GINI系数判断分类内部纯度程度，进行裁剪树枝； 1/3数据预测，根据每个决策树的结果投票确定标签； 输出标签结果，并给出OOB...">
<meta name="generator" content="bookdown 0.34 with bs4_book()">
<meta property="og:title" content="Chapter 15 Random Forest Algorithm | 生物信息随记">
<meta property="og:type" content="book">
<meta property="og:url" content="https://zouhua.top/DraftNotes/randomforestalgorithm.html">
<meta property="og:description" content="随机森林是常用的非线性用于构建分类器的算法，它是由数目众多的弱决策树构建成森林进而对结果进行投票判断标签的方法。随机森林用于分类器的算法过程， 随机切分样本，然后选择2/3用于建模，剩余1/3用于验证袋外误差； 随机选择特征构建决策树，每个叶子节点分成二类； 根据GINI系数判断分类内部纯度程度，进行裁剪树枝； 1/3数据预测，根据每个决策树的结果投票确定标签； 输出标签结果，并给出OOB...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 15 Random Forest Algorithm | 生物信息随记">
<meta name="twitter:description" content="随机森林是常用的非线性用于构建分类器的算法，它是由数目众多的弱决策树构建成森林进而对结果进行投票判断标签的方法。随机森林用于分类器的算法过程， 随机切分样本，然后选择2/3用于建模，剩余1/3用于验证袋外误差； 随机选择特征构建决策树，每个叶子节点分成二类； 根据GINI系数判断分类内部纯度程度，进行裁剪树枝； 1/3数据预测，根据每个决策树的结果投票确定标签； 输出标签结果，并给出OOB...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/Poppins-0.4.6/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.6.0/transition.js"></script><script src="libs/bs3compat-0.6.0/tabs.js"></script><script src="libs/bs3compat-0.6.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.31/datatables.js"></script><link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="assets/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">生物信息随记</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> 介绍</a></li>
<li class="book-part">Data Set</li>
<li><a class="" href="ZeybelDataset.html"><span class="header-section-number">2</span> Zeybel Dataset</a></li>
<li class="book-part">Statistical Methods</li>
<li><a class="" href="GEEandMLM.html"><span class="header-section-number">3</span> GEE and MLM</a></li>
<li><a class="" href="HypothesisTestingMethods.html"><span class="header-section-number">4</span> Hypothesis Testing Methods</a></li>
<li><a class="" href="BatchEffectCorrection.html"><span class="header-section-number">5</span> Batch Effect Correction</a></li>
<li><a class="" href="LinearModelonMicrobialCommunity.html"><span class="header-section-number">6</span> Linear Model on Microbial Community</a></li>
<li><a class="" href="PermutationTest.html"><span class="header-section-number">7</span> Permutation Test</a></li>
<li><a class="" href="SurvivalAnalysis.html"><span class="header-section-number">8</span> Survival Analysis</a></li>
<li class="book-part">Metabolomics Data Analysis</li>
<li><a class="" href="dataprocessing.html"><span class="header-section-number">9</span> Data Processing</a></li>
<li><a class="" href="DimensionReduction.html"><span class="header-section-number">10</span> Dimension Reduction</a></li>
<li><a class="" href="DifferetialAnalysis.html"><span class="header-section-number">11</span> Differetial Analysis</a></li>
<li><a class="" href="FunctionalAnalysis.html"><span class="header-section-number">12</span> Functional Analysis</a></li>
<li><a class="" href="MetOriginAnalysis.html"><span class="header-section-number">13</span> MetOrigin Analysis</a></li>
<li><a class="" href="OtherAnalysis.html"><span class="header-section-number">14</span> Other Analysis</a></li>
<li class="book-part">Machine Learning</li>
<li><a class="active" href="randomforestalgorithm.html"><span class="header-section-number">15</span> Random Forest Algorithm</a></li>
<li><a class="" href="XGBoostalgorithm.html"><span class="header-section-number">16</span> XGBoost Algorithm</a></li>
<li class="book-part">Knowledge</li>
<li><a class="" href="Metageomics.html"><span class="header-section-number">17</span> Metageomics</a></li>
<li><a class="" href="Notes.html"><span class="header-section-number">18</span> Notes</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/HuaZou/DraftNotes">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="randomforestalgorithm" class="section level1" number="15">
<h1>
<span class="header-section-number">15</span> Random Forest Algorithm<a class="anchor" aria-label="anchor" href="#randomforestalgorithm"><i class="fas fa-link"></i></a>
</h1>
<p>随机森林是常用的非线性用于构建分类器的算法，它是由数目众多的弱决策树构建成森林进而对结果进行投票判断标签的方法。随机森林用于分类器的算法过程，</p>
<ul>
<li><p>随机切分样本，然后选择2/3用于建模，剩余1/3用于验证袋外误差；</p></li>
<li><p>随机选择特征构建决策树，每个叶子节点分成二类；</p></li>
<li><p>根据GINI系数判断分类内部纯度程度，进行裁剪树枝；</p></li>
<li><p>1/3数据预测，根据每个决策树的结果投票确定标签；</p></li>
<li><p>输出标签结果，并给出OOB rate；</p></li>
<li><p>随机的含义在于样本和特征是随机选择去构建决策树，这可以有效避免偏差，另外弱分类器组成强分类器也即是多棵决策树组成森林能提升模型效果。</p></li>
</ul>
<p><strong>本文旨在通过R实现随机森林的应用，总共包含：</strong></p>
<ul>
<li>下载数据</li>
<li>加载R包</li>
<li>数据切割</li>
<li>调参（选择最佳决策树数目）</li>
<li>建模（重要性得分）</li>
<li>多次建模选择最佳特征数目（基于OOB rate）</li>
<li>多元回归分析筛选相关特征</li>
<li>风险得分</li>
<li>重新建模</li>
<li>模型效能评估</li>
</ul>
<div id="下载数据" class="section level2" number="15.1">
<h2>
<span class="header-section-number">15.1</span> 下载数据<a class="anchor" aria-label="anchor" href="#%E4%B8%8B%E8%BD%BD%E6%95%B0%E6%8D%AE"><i class="fas fa-link"></i></a>
</h2>
<p>可以点击此处下载数据<a href="https://github.com/HuaZou/DraftNotes/blob/main/InputData/Breast_cancer/clean_data.csv">clean_data.csv</a>或使用<code>wget</code></p>
<div class="sourceCode" id="cb205"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb205-1"><a href="randomforestalgorithm.html#cb205-1" tabindex="-1"></a><span class="fu">wget</span> https://github.com/HuaZou/DraftNotes/blob/main/InputData/Breast_cancer/clean_data.csv</span></code></pre></div>
<blockquote>
<p>该数据集包含569份恶性和良性肿瘤的样本的32类指标，通过这些特征构建区分恶性和良性肿瘤的随机森林分类器.</p>
</blockquote>
<blockquote>
<p>The Breast Cancer datasets is available machine learning repository maintained by the University of California, Irvine. The dataset contains 569 samples of malignant and benign tumor cells.</p>
</blockquote>
</div>
<div id="加载r包-12" class="section level2" number="15.2">
<h2>
<span class="header-section-number">15.2</span> 加载R包<a class="anchor" aria-label="anchor" href="#%E5%8A%A0%E8%BD%BDr%E5%8C%85-12"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb206"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>message <span class="op">=</span> <span class="cn">FALSE</span>, warning <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stat.berkeley.edu/~breiman/RandomForests/">randomForest</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/">caret</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://expasy.org/tools/pROC/">pROC</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># rm(list = ls())</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>stringsAsFactors <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>future.globals.maxSize <span class="op">=</span> <span class="fl">1000</span> <span class="op">*</span> <span class="fl">1024</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">group_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"M"</span>, <span class="st">"B"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="加载数据" class="section level2" number="15.3">
<h2>
<span class="header-section-number">15.3</span> 加载数据<a class="anchor" aria-label="anchor" href="#%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb207"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">datset</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html">fread</a></span><span class="op">(</span><span class="st">"./InputData/Breast_cancer/clean_data.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">datset</span><span class="op">)</span></span>
<span><span class="co">#&gt;    V1 diagnosis radius_mean texture_mean perimeter_mean</span></span>
<span><span class="co">#&gt; 1:  0         M       17.99        10.38         122.80</span></span>
<span><span class="co">#&gt; 2:  1         M       20.57        17.77         132.90</span></span>
<span><span class="co">#&gt; 3:  2         M       19.69        21.25         130.00</span></span>
<span><span class="co">#&gt; 4:  3         M       11.42        20.38          77.58</span></span>
<span><span class="co">#&gt; 5:  4         M       20.29        14.34         135.10</span></span>
<span><span class="co">#&gt; 6:  5         M       12.45        15.70          82.57</span></span>
<span><span class="co">#&gt;    area_mean smoothness_mean compactness_mean</span></span>
<span><span class="co">#&gt; 1:    1001.0         0.11840          0.27760</span></span>
<span><span class="co">#&gt; 2:    1326.0         0.08474          0.07864</span></span>
<span><span class="co">#&gt; 3:    1203.0         0.10960          0.15990</span></span>
<span><span class="co">#&gt; 4:     386.1         0.14250          0.28390</span></span>
<span><span class="co">#&gt; 5:    1297.0         0.10030          0.13280</span></span>
<span><span class="co">#&gt; 6:     477.1         0.12780          0.17000</span></span>
<span><span class="co">#&gt;    concavity_mean concave points_mean symmetry_mean</span></span>
<span><span class="co">#&gt; 1:         0.3001             0.14710        0.2419</span></span>
<span><span class="co">#&gt; 2:         0.0869             0.07017        0.1812</span></span>
<span><span class="co">#&gt; 3:         0.1974             0.12790        0.2069</span></span>
<span><span class="co">#&gt; 4:         0.2414             0.10520        0.2597</span></span>
<span><span class="co">#&gt; 5:         0.1980             0.10430        0.1809</span></span>
<span><span class="co">#&gt; 6:         0.1578             0.08089        0.2087</span></span>
<span><span class="co">#&gt;    fractal_dimension_mean radius_se texture_se perimeter_se</span></span>
<span><span class="co">#&gt; 1:                0.07871    1.0950     0.9053        8.589</span></span>
<span><span class="co">#&gt; 2:                0.05667    0.5435     0.7339        3.398</span></span>
<span><span class="co">#&gt; 3:                0.05999    0.7456     0.7869        4.585</span></span>
<span><span class="co">#&gt; 4:                0.09744    0.4956     1.1560        3.445</span></span>
<span><span class="co">#&gt; 5:                0.05883    0.7572     0.7813        5.438</span></span>
<span><span class="co">#&gt; 6:                0.07613    0.3345     0.8902        2.217</span></span>
<span><span class="co">#&gt;    area_se smoothness_se compactness_se concavity_se</span></span>
<span><span class="co">#&gt; 1:  153.40      0.006399        0.04904      0.05373</span></span>
<span><span class="co">#&gt; 2:   74.08      0.005225        0.01308      0.01860</span></span>
<span><span class="co">#&gt; 3:   94.03      0.006150        0.04006      0.03832</span></span>
<span><span class="co">#&gt; 4:   27.23      0.009110        0.07458      0.05661</span></span>
<span><span class="co">#&gt; 5:   94.44      0.011490        0.02461      0.05688</span></span>
<span><span class="co">#&gt; 6:   27.19      0.007510        0.03345      0.03672</span></span>
<span><span class="co">#&gt;    concave points_se symmetry_se fractal_dimension_se</span></span>
<span><span class="co">#&gt; 1:           0.01587     0.03003             0.006193</span></span>
<span><span class="co">#&gt; 2:           0.01340     0.01389             0.003532</span></span>
<span><span class="co">#&gt; 3:           0.02058     0.02250             0.004571</span></span>
<span><span class="co">#&gt; 4:           0.01867     0.05963             0.009208</span></span>
<span><span class="co">#&gt; 5:           0.01885     0.01756             0.005115</span></span>
<span><span class="co">#&gt; 6:           0.01137     0.02165             0.005082</span></span>
<span><span class="co">#&gt;    radius_worst texture_worst perimeter_worst area_worst</span></span>
<span><span class="co">#&gt; 1:        25.38         17.33          184.60     2019.0</span></span>
<span><span class="co">#&gt; 2:        24.99         23.41          158.80     1956.0</span></span>
<span><span class="co">#&gt; 3:        23.57         25.53          152.50     1709.0</span></span>
<span><span class="co">#&gt; 4:        14.91         26.50           98.87      567.7</span></span>
<span><span class="co">#&gt; 5:        22.54         16.67          152.20     1575.0</span></span>
<span><span class="co">#&gt; 6:        15.47         23.75          103.40      741.6</span></span>
<span><span class="co">#&gt;    smoothness_worst compactness_worst concavity_worst</span></span>
<span><span class="co">#&gt; 1:           0.1622            0.6656          0.7119</span></span>
<span><span class="co">#&gt; 2:           0.1238            0.1866          0.2416</span></span>
<span><span class="co">#&gt; 3:           0.1444            0.4245          0.4504</span></span>
<span><span class="co">#&gt; 4:           0.2098            0.8663          0.6869</span></span>
<span><span class="co">#&gt; 5:           0.1374            0.2050          0.4000</span></span>
<span><span class="co">#&gt; 6:           0.1791            0.5249          0.5355</span></span>
<span><span class="co">#&gt;    concave points_worst symmetry_worst</span></span>
<span><span class="co">#&gt; 1:               0.2654         0.4601</span></span>
<span><span class="co">#&gt; 2:               0.1860         0.2750</span></span>
<span><span class="co">#&gt; 3:               0.2430         0.3613</span></span>
<span><span class="co">#&gt; 4:               0.2575         0.6638</span></span>
<span><span class="co">#&gt; 5:               0.1625         0.2364</span></span>
<span><span class="co">#&gt; 6:               0.1741         0.3985</span></span>
<span><span class="co">#&gt;    fractal_dimension_worst</span></span>
<span><span class="co">#&gt; 1:                 0.11890</span></span>
<span><span class="co">#&gt; 2:                 0.08902</span></span>
<span><span class="co">#&gt; 3:                 0.08758</span></span>
<span><span class="co">#&gt; 4:                 0.17300</span></span>
<span><span class="co">#&gt; 5:                 0.07678</span></span>
<span><span class="co">#&gt; 6:                 0.12440</span></span></code></pre></div>
</div>
<div id="数据切割" class="section level2" number="15.4">
<h2>
<span class="header-section-number">15.4</span> 数据切割<a class="anchor" aria-label="anchor" href="#%E6%95%B0%E6%8D%AE%E5%88%87%E5%89%B2"><i class="fas fa-link"></i></a>
</h2>
<p>对数据集按照70%的比例划分成训练集和测试集，其中训练集用于构建模型，测试集用于评估模型效能。另外，在这一步前也有教程对特征进行选择，筛选组间差异大的特征用于建模。这里使用 caret::createDataPartition函数进行划分数据集，它能够根据组间比例合理分割数据。</p>
<div class="sourceCode" id="cb208"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mdat</span> <span class="op">&lt;-</span> <span class="va">datset</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">V1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>Group <span class="op">=</span> <span class="va">diagnosis</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Group</span>, levels <span class="op">=</span> <span class="va">group_names</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html">colnames</a></span><span class="op">(</span><span class="va">mdat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/make.names.html">make.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html">colnames</a></span><span class="op">(</span><span class="va">mdat</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">trainIndex</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html">createDataPartition</a></span><span class="op">(</span></span>
<span>          <span class="va">mdat</span><span class="op">$</span><span class="va">Group</span>, </span>
<span>          p <span class="op">=</span> <span class="fl">0.7</span>, </span>
<span>          list <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>          times <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">trainData</span> <span class="op">&lt;-</span> <span class="va">mdat</span><span class="op">[</span><span class="va">trainIndex</span>, <span class="op">]</span></span>
<span><span class="va">X_train</span> <span class="op">&lt;-</span> <span class="va">trainData</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">y_train</span> <span class="op">&lt;-</span> <span class="va">trainData</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="va">testData</span> <span class="op">&lt;-</span> <span class="va">mdat</span><span class="op">[</span><span class="op">-</span><span class="va">trainIndex</span>, <span class="op">]</span></span>
<span><span class="va">X_test</span> <span class="op">&lt;-</span> <span class="va">testData</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">y_test</span> <span class="op">&lt;-</span> <span class="va">testData</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span></code></pre></div>
</div>
<div id="调参选择最佳决策树数目" class="section level2" number="15.5">
<h2>
<span class="header-section-number">15.5</span> 调参（选择最佳决策树数目）<a class="anchor" aria-label="anchor" href="#%E8%B0%83%E5%8F%82%E9%80%89%E6%8B%A9%E6%9C%80%E4%BD%B3%E5%86%B3%E7%AD%96%E6%A0%91%E6%95%B0%E7%9B%AE"><i class="fas fa-link"></i></a>
</h2>
<p>随机森林算法的参数众多，本文选择对mtry和ntree两个参数进行调参，其他均使用默认参数。</p>
<ul>
<li>
<em>mtry</em>：随机选择特征数目</li>
<li>
<em>ntree</em>：构成森林的决策树数目</li>
</ul>
<div class="sourceCode" id="cb209"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">RUN</span> <span class="op">&lt;-</span> <span class="cn">F</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">RUN</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># N-repeat K-fold cross-validation</span></span>
<span>  <span class="va">myControl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span></span>
<span>    method <span class="op">=</span> <span class="st">"repeatedcv"</span>,</span>
<span>    number <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    repeats <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    search <span class="op">=</span> <span class="st">"random"</span>,</span>
<span>    classProbs <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    verboseIter <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    allowParallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># customRF</span></span>
<span>  <span class="co"># https://machinelearningmastery.com/tune-machine-learning-algorithms-in-r/</span></span>
<span>  <span class="va">customRF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"Classification"</span>,</span>
<span>                   library <span class="op">=</span> <span class="st">"randomForest"</span>,</span>
<span>                   loop <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">customRF</span><span class="op">$</span><span class="va">parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    parameter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mtry"</span>, <span class="st">"ntree"</span><span class="op">)</span>,</span>
<span>    class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"numeric"</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mtry"</span>, <span class="st">"ntree"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">customRF</span><span class="op">$</span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">len</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">search</span> <span class="op">=</span> <span class="st">"grid"</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span></span>
<span>  <span class="va">customRF</span><span class="op">$</span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">wts</span>, <span class="va">param</span>, <span class="va">lev</span>, <span class="va">last</span>, <span class="va">weights</span>, <span class="va">classProbs</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html">randomForest</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, mtry <span class="op">=</span> <span class="va">param</span><span class="op">$</span><span class="va">mtry</span>, ntree<span class="op">=</span><span class="va">param</span><span class="op">$</span><span class="va">ntree</span>, <span class="va">...</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">customRF</span><span class="op">$</span><span class="va">predict</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">modelFit</span>, <span class="va">newdata</span>, <span class="va">preProc</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">submodels</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modelFit</span>, <span class="va">newdata</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">customRF</span><span class="op">$</span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">modelFit</span>, <span class="va">newdata</span>, <span class="va">preProc</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">submodels</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modelFit</span>, <span class="va">newdata</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">customRF</span><span class="op">$</span><span class="va">sort</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="op">]</span><span class="op">}</span></span>
<span>  <span class="va">customRF</span><span class="op">$</span><span class="va">levels</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="va">x</span><span class="op">$</span><span class="va">classes</span><span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># tuning parameters</span></span>
<span>  <span class="va">tuneGrid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span></span>
<span>    .mtry <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">12</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span>, <span class="co"># sqrt(ncol(X_train))</span></span>
<span>    .ntree <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">2000</span>, <span class="fl">500</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Register parallel cores</span></span>
<span>  <span class="fu">doParallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html">registerDoParallel</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># train model</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span>  <span class="va">tune_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span></span>
<span>    <span class="va">Group</span> <span class="op">~</span><span class="va">.</span>,</span>
<span>    data <span class="op">=</span> <span class="va">trainData</span>,</span>
<span>    method <span class="op">=</span> <span class="va">customRF</span>, <span class="co">#"rf",</span></span>
<span>    trControl <span class="op">=</span> <span class="va">myControl</span>,</span>
<span>    tuneGrid <span class="op">=</span> <span class="va">tuneGrid</span>,</span>
<span>    metric <span class="op">=</span> <span class="st">"Accuracy"</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## Plot model accuracy vs different values of Cost</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">tune_fit</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## Print the best tuning parameter that maximizes model accuracy</span></span>
<span>  <span class="va">optimalVar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tune_fit</span><span class="op">$</span><span class="va">results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">tune_fit</span><span class="op">$</span><span class="va">results</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">optimalVar</span><span class="op">)</span>  </span>
<span><span class="op">}</span> </span>
<span></span>
<span><span class="va">optimalVar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mtry <span class="op">=</span> <span class="fl">10</span>, ntree <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>
<p>结果：</p>
<ul>
<li>最佳随机特征数目（使用32个特征用于建模，从中随机抽取7个特征构建决策树）：7</li>
<li>最佳决策树数目：1000</li>
</ul>
</li>
</ul>
</div>
<div id="建模" class="section level2" number="15.6">
<h2>
<span class="header-section-number">15.6</span> 建模<a class="anchor" aria-label="anchor" href="#%E5%BB%BA%E6%A8%A1"><i class="fas fa-link"></i></a>
</h2>
<p>使用上述最佳参数建模</p>
<div class="sourceCode" id="cb210"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">rf_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html">randomForest</a></span><span class="op">(</span></span>
<span>  <span class="va">Group</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  data <span class="op">=</span> <span class="va">trainData</span>,</span>
<span>  importance <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  proximity <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  mtry <span class="op">=</span> <span class="va">optimalVar</span><span class="op">$</span><span class="va">mtry</span>,</span>
<span>  ntree <span class="op">=</span> <span class="va">optimalVar</span><span class="op">$</span><span class="va">ntree</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rf_fit</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt;  randomForest(formula = Group ~ ., data = trainData, importance = TRUE,      proximity = TRUE, mtry = optimalVar$mtry, ntree = optimalVar$ntree) </span></span>
<span><span class="co">#&gt;                Type of random forest: classification</span></span>
<span><span class="co">#&gt;                      Number of trees: 1000</span></span>
<span><span class="co">#&gt; No. of variables tried at each split: 10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         OOB estimate of  error rate: 4.01%</span></span>
<span><span class="co">#&gt; Confusion matrix:</span></span>
<span><span class="co">#&gt;     M   B class.error</span></span>
<span><span class="co">#&gt; M 140   9  0.06040268</span></span>
<span><span class="co">#&gt; B   7 243  0.02800000</span></span></code></pre></div>
<ul>
<li>
<p>结果：</p>
<ul>
<li>该模型的袋外误差OOB仅为4.01%，也即是准确率高达95.99%。</li>
</ul>
</li>
</ul>
</div>
<div id="特征的重要性得分" class="section level2" number="15.7">
<h2>
<span class="header-section-number">15.7</span> 特征的重要性得分<a class="anchor" aria-label="anchor" href="#%E7%89%B9%E5%BE%81%E7%9A%84%E9%87%8D%E8%A6%81%E6%80%A7%E5%BE%97%E5%88%86"><i class="fas fa-link"></i></a>
</h2>
<p>获取所有特征的重要性得分，此处使用MeanDecreaseAccuracy。</p>
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imp_biomarker</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/importance.html">importance</a></span><span class="op">(</span><span class="va">rf_fit</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>, rownames <span class="op">=</span> <span class="st">"Features"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">MeanDecreaseAccuracy</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">imp_biomarker</span></span>
<span><span class="co">#&gt; # A tibble: 30 × 5</span></span>
<span><span class="co">#&gt;    Features                 M     B MeanDecreaseAccuracy</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 radius_worst         16.4  23.4                  25.9</span></span>
<span><span class="co">#&gt;  2 concave.points_worst 15.0  21.2                  25.2</span></span>
<span><span class="co">#&gt;  3 area_worst           16.9  20.4                  24.4</span></span>
<span><span class="co">#&gt;  4 concave.points_mean  17.3  14.9                  22.3</span></span>
<span><span class="co">#&gt;  5 perimeter_worst      15.6  17.2                  21.8</span></span>
<span><span class="co">#&gt;  6 area_se               8.81 17.5                  19.3</span></span>
<span><span class="co">#&gt;  7 concavity_worst      15.4   7.74                 17.8</span></span>
<span><span class="co">#&gt;  8 concavity_mean        9.93 12.8                  16.4</span></span>
<span><span class="co">#&gt;  9 texture_worst        13.3  10.9                  15.9</span></span>
<span><span class="co">#&gt; 10 radius_se             6.94 12.6                  14.7</span></span>
<span><span class="co">#&gt; # ℹ 20 more rows</span></span>
<span><span class="co">#&gt; # ℹ 1 more variable: MeanDecreaseGini &lt;dbl&gt;</span></span></code></pre></div>
</div>
<div id="多次建模选择最佳特征数目基于oob-rate" class="section level2" number="15.8">
<h2>
<span class="header-section-number">15.8</span> 多次建模选择最佳特征数目（基于OOB rate）<a class="anchor" aria-label="anchor" href="#%E5%A4%9A%E6%AC%A1%E5%BB%BA%E6%A8%A1%E9%80%89%E6%8B%A9%E6%9C%80%E4%BD%B3%E7%89%B9%E5%BE%81%E6%95%B0%E7%9B%AE%E5%9F%BA%E4%BA%8Eoob-rate"><i class="fas fa-link"></i></a>
</h2>
<p>上述模型选了所有32个特征用于建模，这是单次建模的结果，为了更好确定最佳特征数目，采用五次建模的结果寻找最小OOB rate对应的特征数目作为最佳特征数目。</p>
<p>另外，最佳决策树数目参考第一次模型的 1000，也作为本次最佳决策树数目。</p>
<div class="sourceCode" id="cb212"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">error.cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/rfcv.html">rfcv</a></span><span class="op">(</span>trainx <span class="op">=</span> <span class="va">X_train</span>, </span>
<span>              trainy <span class="op">=</span> <span class="va">y_train</span>, </span>
<span>              cv.fold <span class="op">=</span> <span class="fl">5</span>, </span>
<span>              scale <span class="op">=</span> <span class="st">"log"</span>, </span>
<span>              step <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>              ntree <span class="op">=</span> <span class="va">optimalVar</span><span class="op">$</span><span class="va">ntree</span><span class="op">)</span></span>
<span>  <span class="va">error.cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">error.cv</span>, <span class="va">fit</span><span class="op">$</span><span class="va">error.cv</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span><span class="co">#&gt; [1] 4</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span></span>
<span><span class="va">n.var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">error.cv</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html">colnames</a></span><span class="op">(</span><span class="va">error.cv</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">'error'</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, sep <span class="op">=</span> <span class="st">'.'</span><span class="op">)</span></span>
<span><span class="va">err.mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">error.cv</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">err.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>num <span class="op">=</span> <span class="va">n.var</span>, </span>
<span>                     err.mean <span class="op">=</span> <span class="va">err.mean</span>,</span>
<span>                     <span class="va">error.cv</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">err.df</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;    num   err.mean    error.1    error.2    error.3</span></span>
<span><span class="co">#&gt; 30  30 0.04260652 0.04511278 0.04511278 0.04010025</span></span>
<span><span class="co">#&gt; 27  27 0.04260652 0.04511278 0.04511278 0.04260652</span></span>
<span><span class="co">#&gt; 24  24 0.04260652 0.04761905 0.04511278 0.04010025</span></span>
<span><span class="co">#&gt; 22  22 0.04160401 0.04260652 0.04511278 0.04010025</span></span>
<span><span class="co">#&gt; 20  20 0.04260652 0.04761905 0.04260652 0.04260652</span></span>
<span><span class="co">#&gt; 18  18 0.04360902 0.04511278 0.04511278 0.04010025</span></span>
<span><span class="co">#&gt;       error.4</span></span>
<span><span class="co">#&gt; 30 0.04260652</span></span>
<span><span class="co">#&gt; 27 0.04010025</span></span>
<span><span class="co">#&gt; 24 0.04010025</span></span>
<span><span class="co">#&gt; 22 0.04010025</span></span>
<span><span class="co">#&gt; 20 0.04010025</span></span>
<span><span class="co">#&gt; 18 0.04511278</span></span></code></pre></div>
<ul>
<li>optimal number of biomarkers chosen by min cv.error</li>
</ul>
<div class="sourceCode" id="cb213"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">optimal</span> <span class="op">&lt;-</span> <span class="va">err.df</span><span class="op">$</span><span class="va">num</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">err.df</span><span class="op">$</span><span class="va">err.mean</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">err.df</span><span class="op">$</span><span class="va">err.mean</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">main_theme</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.line.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.5</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>    axis.line.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.5</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>    axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"right"</span>,</span>
<span>    legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>    text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"sans"</span>, size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">err.df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">err.df</span><span class="op">$</span><span class="va">num</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">err.df</span><span class="op">$</span><span class="va">error.1</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'grey'</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">err.df</span><span class="op">$</span><span class="va">error.2</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'grey'</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">err.df</span><span class="op">$</span><span class="va">error.3</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'grey'</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">err.df</span><span class="op">$</span><span class="va">error.4</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'grey'</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">err.df</span><span class="op">$</span><span class="va">error.5</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'grey'</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">err.df</span><span class="op">$</span><span class="va">err.mean</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'black'</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">optimal</span>, color <span class="op">=</span> <span class="st">'red'</span>, lwd <span class="op">=</span> <span class="fl">0.36</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_trans.html">coord_trans</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"log2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Number of Features '</span>, y <span class="op">=</span> <span class="st">'Cross-validation error rate'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, </span>
<span>             x <span class="op">=</span> <span class="va">optimal</span>, </span>
<span>             y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">err.df</span><span class="op">$</span><span class="va">err.mean</span><span class="op">)</span>, </span>
<span>             label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Optimal = "</span>, <span class="va">optimal</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="va">main_theme</span></span>
<span><span class="va">pl</span></span></code></pre></div>
<div class="inline-figure"><img src="70-MachineLearing_RandomForest_files/figure-html/unnamed-chunk-9-1.png" width="100%"></div>
<ul>
<li>
<p>结果：</p>
<ul>
<li><p>袋外误差OOB rate从特征数目为1到特征数目为20呈快速下降趋势，虽然下降数目仅在小数点二位上；</p></li>
<li><p>最佳特征数目是22，也即是选择重要性得分最高的22个特征即可（原本是32个特征，剔除10个特征用于建模）。</p></li>
</ul>
</li>
<li><p>importance of optimal biomarker</p></li>
</ul>
<div class="sourceCode" id="cb214"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imp_biomarker</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">optimal</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Features</span>, <span class="va">MeanDecreaseAccuracy</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">MeanDecreaseAccuracy</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Features <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_inorder</a></span><span class="op">(</span><span class="va">Features</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Features</span>, y <span class="op">=</span> <span class="va">MeanDecreaseAccuracy</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, fill <span class="op">=</span> <span class="st">"white"</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Mean decrease accuracy"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="va">main_theme</span></span></code></pre></div>
<div class="inline-figure"><img src="70-MachineLearing_RandomForest_files/figure-html/unnamed-chunk-10-1.png" width="100%"></div>
<ul>
<li>
<p>结果：</p>
<ul>
<li>MeanDecreaseAccuracy得分最高的是area_worst（MDA = 24.52%）</li>
</ul>
</li>
</ul>
</div>
<div id="多元回归分析筛选相关特征" class="section level2" number="15.9">
<h2>
<span class="header-section-number">15.9</span> 多元回归分析筛选相关特征<a class="anchor" aria-label="anchor" href="#%E5%A4%9A%E5%85%83%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90%E7%AD%9B%E9%80%89%E7%9B%B8%E5%85%B3%E7%89%B9%E5%BE%81"><i class="fas fa-link"></i></a>
</h2>
<p>上述22个特征在建模过程还是偏多，可以通过多元回归分析筛选与响应变量（分类变量）最相关的自变量。</p>
<ul>
<li>转换字符型标签成数值型</li>
<li>标准化自变量，降低不同单位的影响</li>
<li>采用logist regression算法</li>
</ul>
<p>该步骤可选择也可不选择，因为后续分析发现如果严格按照pvalue &lt; 0.05则仅能筛选到2-3个特征。</p>
<div class="sourceCode" id="cb215"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mdat_mulvar</span> <span class="op">&lt;-</span> <span class="va">mdat</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Group"</span>, <span class="va">imp_biomarker</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">optimal</span>, <span class="op">]</span><span class="op">$</span><span class="va">Features</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">Group</span> <span class="op">==</span> <span class="va">group_names</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mdat_mulvar</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">mdat_mulvar</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html">colnames</a></span><span class="op">(</span><span class="va">mdat_mulvar</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">" ~ "</span>, </span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html">colnames</a></span><span class="op">(</span><span class="va">mdat_mulvar</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">mdat_mulvar</span><span class="op">)</span><span class="op">]</span>, collapse <span class="op">=</span> <span class="st">" + "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">fma</span>, data <span class="op">=</span> <span class="va">mdat_mulvar</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat_coef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">`Pr(&gt;|z|)`</span> <span class="op">&lt;</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"FeatureID"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">dat_coef</span><span class="op">)</span></span>
<span><span class="co">#&gt;           FeatureID  Estimate Std. Error   z value</span></span>
<span><span class="co">#&gt; 1   concavity_worst  8.093168  4.4049617  1.837285</span></span>
<span><span class="co">#&gt; 2     texture_worst  1.942546  1.4717008  1.319932</span></span>
<span><span class="co">#&gt; 3 compactness_worst -4.415926  2.4731083 -1.785577</span></span>
<span><span class="co">#&gt; 4    symmetry_worst  1.354215  0.7515816  1.801820</span></span>
<span><span class="co">#&gt; 5 concave.points_se  4.185960  2.2931514  1.825418</span></span>
<span><span class="co">#&gt; 6      concavity_se -6.405829  2.9571126 -2.166244</span></span>
<span><span class="co">#&gt;     Pr(&gt;|z|)</span></span>
<span><span class="co">#&gt; 1 0.06616790</span></span>
<span><span class="co">#&gt; 2 0.18685757</span></span>
<span><span class="co">#&gt; 3 0.07416774</span></span>
<span><span class="co">#&gt; 4 0.07157373</span></span>
<span><span class="co">#&gt; 5 0.06793796</span></span>
<span><span class="co">#&gt; 6 0.03029252</span></span></code></pre></div>
<ul>
<li>
<p>结果：</p>
<ul>
<li>在选择Pr(&gt;|z|) &lt; 0.05后，结果不好，后将阈值设置为Pr(&gt;|z|) &lt; 0.2，最终5个特征符合要求。</li>
</ul>
</li>
</ul>
</div>
<div id="疾病风险得分" class="section level2" number="15.10">
<h2>
<span class="header-section-number">15.10</span> 疾病风险得分<a class="anchor" aria-label="anchor" href="#%E7%96%BE%E7%97%85%E9%A3%8E%E9%99%A9%E5%BE%97%E5%88%86"><i class="fas fa-link"></i></a>
</h2>
<p>nomogram是一类可以可视化上述5个特征对恶性肿瘤贡献的图形，它也是通过多元线性回归对疾病贡献得到打分，然后分别累加各个特征对疾病的得分得到一个总分，最后总分对应疾病分享百分比。</p>
<p>该处没有对自变量进行标准化，本来是要做的，但考虑到每个指标所含有的临床学意义，就使用了原始值。</p>
<div class="sourceCode" id="cb216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://hbiostat.org/R/rms/">rms</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">selected_columns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Group"</span>, <span class="va">dat_coef</span><span class="op">$</span><span class="va">FeatureID</span><span class="op">)</span></span>
<span><span class="va">nom_optimal</span> <span class="op">&lt;-</span> <span class="va">trainData</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">selected_columns</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">Group</span> <span class="op">==</span> <span class="st">"B"</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ddist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/datadist.html">datadist</a></span><span class="op">(</span><span class="va">nom_optimal</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>datadist <span class="op">=</span> <span class="st">"ddist"</span><span class="op">)</span></span>
<span><span class="va">fit_nom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/lrm.html">lrm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html">formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html">colnames</a></span><span class="op">(</span><span class="va">nom_optimal</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">" ~ "</span>, </span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html">colnames</a></span><span class="op">(</span><span class="va">nom_optimal</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">nom_optimal</span><span class="op">)</span><span class="op">]</span>, collapse <span class="op">=</span> <span class="st">" + "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         data <span class="op">=</span> <span class="va">nom_optimal</span><span class="op">)</span></span>
<span><span class="va">nom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/nomogram.html">nomogram</a></span><span class="op">(</span><span class="va">fit_nom</span>, fun <span class="op">=</span> <span class="va">plogis</span>, funlabel <span class="op">=</span> <span class="st">"Risk of Disease"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">nom</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="70-MachineLearing_RandomForest_files/figure-html/unnamed-chunk-12-1.png" width="100%"></div>
<ul>
<li>结果：</li>
</ul>
<p>concave points_mean(凹点), concavity_worst(凹度), texture_worst(质地) 和 symmetry_worst(对称) 都随着数值增大获得更高的疾病得分， 而 compactness_mean(紧密) 则是数值越高，疾病得分越低。综合这五个指标的疾病得分即可获得疾病总得分，然后再对应到疾病风险概率上。</p>
<p>Notice: 上述四个指标均与乳腺癌发生正相关，而最后一个指标则是负相关，这在临床上也是符合要求的</p>
<p>比如:</p>
<ul>
<li>concave points_mean_= 0.04 (20 points)</li>
<li>concavity_worst = 1.2 (20 points)</li>
<li>texture_worst = 25 (10 points)</li>
<li>symmetry_worst = 0.4 (10 points)</li>
<li>compactness_mean = 0.25 (20 points)</li>
</ul>
<p>计算得分总和:</p>
<p>20 + 20 + 10 + 10 + 20 = 80
80分对应疾病风险概率是100%，也即是说某位检查者的上述五类指标符合该要求，意味着她有100%的概率患有恶性乳腺癌。</p>
</div>
<div id="重新建模" class="section level2" number="15.11">
<h2>
<span class="header-section-number">15.11</span> 重新建模<a class="anchor" aria-label="anchor" href="#%E9%87%8D%E6%96%B0%E5%BB%BA%E6%A8%A1"><i class="fas fa-link"></i></a>
</h2>
<p>使用上述五个指标重新建模</p>
<div class="sourceCode" id="cb217"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">selected_columns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Group"</span>, <span class="va">dat_coef</span><span class="op">$</span><span class="va">FeatureID</span><span class="op">)</span></span>
<span></span>
<span><span class="va">trainData_optimal</span> <span class="op">&lt;-</span> <span class="va">trainData</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">selected_columns</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">testData_optimal</span> <span class="op">&lt;-</span> <span class="va">testData</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">selected_columns</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">rf_fit_optimal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html">randomForest</a></span><span class="op">(</span></span>
<span>  <span class="va">Group</span> <span class="op">~</span> <span class="va">.</span>, </span>
<span>  data <span class="op">=</span> <span class="va">trainData_optimal</span>, </span>
<span>  importance <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  proximity <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ntree <span class="op">=</span> <span class="va">optimalVar</span><span class="op">$</span><span class="va">ntree</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rf_fit_optimal</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt;  randomForest(formula = Group ~ ., data = trainData_optimal, importance = TRUE,      proximity = TRUE, ntree = optimalVar$ntree) </span></span>
<span><span class="co">#&gt;                Type of random forest: classification</span></span>
<span><span class="co">#&gt;                      Number of trees: 1000</span></span>
<span><span class="co">#&gt; No. of variables tried at each split: 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         OOB estimate of  error rate: 12.03%</span></span>
<span><span class="co">#&gt; Confusion matrix:</span></span>
<span><span class="co">#&gt;     M   B class.error</span></span>
<span><span class="co">#&gt; M 127  22    0.147651</span></span>
<span><span class="co">#&gt; B  26 224    0.104000</span></span></code></pre></div>
<ul>
<li>ConfusionMatrix</li>
</ul>
<div class="sourceCode" id="cb218"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">group_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="va">pred_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">rf_fit_optimal</span>, newdata <span class="op">=</span> <span class="va">testData_optimal</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span><span class="va">pred_raw</span>, <span class="va">testData_optimal</span><span class="op">$</span><span class="va">Group</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Confusion Matrix and Statistics</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           Reference</span></span>
<span><span class="co">#&gt; Prediction  M  B</span></span>
<span><span class="co">#&gt;          M 52 14</span></span>
<span><span class="co">#&gt;          B 11 93</span></span>
<span><span class="co">#&gt;                                           </span></span>
<span><span class="co">#&gt;                Accuracy : 0.8529          </span></span>
<span><span class="co">#&gt;                  95% CI : (0.7906, 0.9025)</span></span>
<span><span class="co">#&gt;     No Information Rate : 0.6294          </span></span>
<span><span class="co">#&gt;     P-Value [Acc &gt; NIR] : 9.513e-11       </span></span>
<span><span class="co">#&gt;                                           </span></span>
<span><span class="co">#&gt;                   Kappa : 0.6878          </span></span>
<span><span class="co">#&gt;                                           </span></span>
<span><span class="co">#&gt;  Mcnemar's Test P-Value : 0.6892          </span></span>
<span><span class="co">#&gt;                                           </span></span>
<span><span class="co">#&gt;             Sensitivity : 0.8254          </span></span>
<span><span class="co">#&gt;             Specificity : 0.8692          </span></span>
<span><span class="co">#&gt;          Pos Pred Value : 0.7879          </span></span>
<span><span class="co">#&gt;          Neg Pred Value : 0.8942          </span></span>
<span><span class="co">#&gt;              Prevalence : 0.3706          </span></span>
<span><span class="co">#&gt;          Detection Rate : 0.3059          </span></span>
<span><span class="co">#&gt;    Detection Prevalence : 0.3882          </span></span>
<span><span class="co">#&gt;       Balanced Accuracy : 0.8473          </span></span>
<span><span class="co">#&gt;                                           </span></span>
<span><span class="co">#&gt;        'Positive' Class : M               </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="va">pred_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">rf_fit_optimal</span>, newdata <span class="op">=</span> <span class="va">testData_optimal</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span>  </span></code></pre></div>
<ul>
<li>performance of classifier</li>
</ul>
<div class="sourceCode" id="cb219"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Evaluate_index</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">DataTest</span>, </span>
<span>    <span class="va">PredProb</span> <span class="op">=</span> <span class="va">pred_prob</span>, </span>
<span>    <span class="va">label</span> <span class="op">=</span> <span class="va">group_names</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>    <span class="va">PredRaw</span> <span class="op">=</span> <span class="va">pred_raw</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># DataTest = testData</span></span>
<span>  <span class="co"># PredProb = pred_prob</span></span>
<span>  <span class="co"># label = group_names[1]</span></span>
<span>  <span class="co"># PredRaw = pred_raw</span></span>
<span>  </span>
<span>  <span class="co"># ROC object</span></span>
<span>  <span class="va">rocobj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span><span class="va">DataTest</span><span class="op">$</span><span class="va">Group</span>, <span class="va">PredProb</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># confusionMatrix</span></span>
<span>  <span class="va">con_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">PredRaw</span>, <span class="va">DataTest</span><span class="op">$</span><span class="va">Group</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># index</span></span>
<span>  <span class="va">TP</span> <span class="op">&lt;-</span> <span class="va">con_matrix</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">FN</span> <span class="op">&lt;-</span> <span class="va">con_matrix</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">FP</span> <span class="op">&lt;-</span> <span class="va">con_matrix</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">TN</span> <span class="op">&lt;-</span> <span class="va">con_matrix</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">rocbj_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>threshold <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">rocobj</span><span class="op">$</span><span class="va">thresholds</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>                         sensitivities <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">rocobj</span><span class="op">$</span><span class="va">sensitivities</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>                         specificities <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">rocobj</span><span class="op">$</span><span class="va">specificities</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>                         value <span class="op">=</span> <span class="va">rocobj</span><span class="op">$</span><span class="va">sensitivities</span> <span class="op">+</span> </span>
<span>                           <span class="va">rocobj</span><span class="op">$</span><span class="va">specificities</span><span class="op">)</span></span>
<span>  <span class="va">max_value_row</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">rocbj_df</span><span class="op">$</span><span class="va">value</span><span class="op">)</span> <span class="op">==</span> <span class="va">rocbj_df</span><span class="op">$</span><span class="va">value</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">threshold</span> <span class="op">&lt;-</span> <span class="va">rocbj_df</span><span class="op">$</span><span class="va">threshold</span><span class="op">[</span><span class="va">max_value_row</span><span class="op">]</span></span>
<span>  <span class="va">sen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">TP</span> <span class="op">/</span> <span class="op">(</span><span class="va">TP</span> <span class="op">+</span> <span class="va">FN</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span> <span class="co"># caret::sensitivity(con_matrix)</span></span>
<span>  <span class="va">spe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">TN</span> <span class="op">/</span> <span class="op">(</span><span class="va">TN</span> <span class="op">+</span> <span class="va">FP</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span> <span class="co"># caret::specificity(con_matrix)</span></span>
<span>  <span class="va">acc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="op">(</span><span class="va">TP</span> <span class="op">+</span> <span class="va">TN</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">TP</span> <span class="op">+</span> <span class="va">TN</span> <span class="op">+</span> <span class="va">FP</span> <span class="op">+</span> <span class="va">FN</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span> <span class="co"># Accuracy</span></span>
<span>  <span class="va">pre</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">TP</span> <span class="op">/</span> <span class="op">(</span><span class="va">TP</span> <span class="op">+</span> <span class="va">FP</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span> <span class="co"># precision</span></span>
<span>  <span class="va">rec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">TP</span> <span class="op">/</span> <span class="op">(</span><span class="va">TP</span> <span class="op">+</span> <span class="va">FN</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span> <span class="co"># recall</span></span>
<span>  <span class="co">#F1S &lt;- round(2 * TP / (TP + TN + FP + FN + TP - TN), 3)# F1-Score</span></span>
<span>  <span class="va">F1S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">TP</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">TP</span> <span class="op">+</span> <span class="va">FP</span> <span class="op">+</span> <span class="va">FN</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="co"># F1-Score</span></span>
<span>  <span class="va">youden</span> <span class="op">&lt;-</span> <span class="va">sen</span> <span class="op">+</span> <span class="va">spe</span> <span class="op">-</span> <span class="fl">1</span> <span class="co"># youden index</span></span>
<span>  </span>
<span>  <span class="va">index_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Threshold"</span>, <span class="st">"Sensitivity"</span>,</span>
<span>                                   <span class="st">"Specificity"</span>, <span class="st">"Accuracy"</span>,</span>
<span>                                   <span class="st">"Precision"</span>, <span class="st">"Recall"</span>,</span>
<span>                                   <span class="st">"F1 Score"</span>, <span class="st">"Youden index"</span><span class="op">)</span>,</span>
<span>                         Value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">threshold</span>, <span class="va">sen</span>, <span class="va">spe</span>,</span>
<span>                                   <span class="va">acc</span>, <span class="va">pre</span>, <span class="va">rec</span>, <span class="va">F1S</span>, <span class="va">youden</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Index"</span>, <span class="va">label</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">index_df</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">Evaluate_index</span><span class="op">(</span></span>
<span>    DataTest <span class="op">=</span> <span class="va">testData</span>, </span>
<span>    PredProb <span class="op">=</span> <span class="va">pred_prob</span>, </span>
<span>    label <span class="op">=</span> <span class="va">group_names</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>    PredRaw <span class="op">=</span> <span class="va">pred_raw</span><span class="op">)</span></span>
<span><span class="co">#&gt;          Index     B</span></span>
<span><span class="co">#&gt; 1    Threshold 0.312</span></span>
<span><span class="co">#&gt; 2  Sensitivity 0.825</span></span>
<span><span class="co">#&gt; 3  Specificity 0.869</span></span>
<span><span class="co">#&gt; 4     Accuracy 0.853</span></span>
<span><span class="co">#&gt; 5    Precision 0.788</span></span>
<span><span class="co">#&gt; 6       Recall 0.825</span></span>
<span><span class="co">#&gt; 7     F1 Score 0.806</span></span>
<span><span class="co">#&gt; 8 Youden index 0.694</span></span></code></pre></div>
<ul>
<li>AUROC</li>
</ul>
<div class="sourceCode" id="cb220"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">AUROC</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">DataTest</span>, </span>
<span>    <span class="va">PredProb</span> <span class="op">=</span> <span class="va">pred_prob</span>, </span>
<span>    <span class="va">label</span> <span class="op">=</span> <span class="va">group_names</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>    <span class="va">DataProf</span> <span class="op">=</span> <span class="va">profile</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># DataTest = testData</span></span>
<span>  <span class="co"># PredProb = pred_prob</span></span>
<span>  <span class="co"># label = group_names[1]</span></span>
<span>  <span class="co"># DataProf = profile</span></span>
<span>  </span>
<span>  <span class="co"># ROC object</span></span>
<span>  <span class="va">rocobj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span><span class="va">DataTest</span><span class="op">$</span><span class="va">Group</span>, <span class="va">PredProb</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Youden index: cutoff point</span></span>
<span>  <span class="co"># plot(rocobj,</span></span>
<span>  <span class="co">#      legacy.axes = TRUE,</span></span>
<span>  <span class="co">#      of = "thresholds", </span></span>
<span>  <span class="co">#      thresholds = "best", </span></span>
<span>  <span class="co">#      print.thres="best")</span></span>
<span>  </span>
<span>  <span class="co"># AUROC data</span></span>
<span>  <span class="va">roc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>tpr <span class="op">=</span> <span class="va">rocobj</span><span class="op">$</span><span class="va">sensitivities</span>,</span>
<span>                    fpr <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">rocobj</span><span class="op">$</span><span class="va">specificities</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># AUC 95% CI</span></span>
<span>  <span class="va">rocobj_CI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span><span class="va">DataTest</span><span class="op">$</span><span class="va">Group</span>, <span class="va">PredProb</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, </span>
<span>                   ci <span class="op">=</span> <span class="cn">TRUE</span>, percent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">roc_CI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">rocobj_CI</span><span class="op">$</span><span class="va">ci</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="va">roc_CI_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">label</span>, </span>
<span>                       <span class="st">" ("</span>, <span class="st">"AUC="</span>, <span class="va">roc_CI</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, </span>
<span>                       <span class="st">", 95%CI "</span>, <span class="va">roc_CI</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"-"</span>, <span class="va">roc_CI</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, </span>
<span>                       <span class="st">")"</span><span class="op">)</span></span>
<span>  <span class="co"># ROC dataframe</span></span>
<span>  <span class="va">rocbj_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>threshold <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">rocobj</span><span class="op">$</span><span class="va">thresholds</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>                         sensitivities <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">rocobj</span><span class="op">$</span><span class="va">sensitivities</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>                         specificities <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">rocobj</span><span class="op">$</span><span class="va">specificities</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>                         value <span class="op">=</span> <span class="va">rocobj</span><span class="op">$</span><span class="va">sensitivities</span> <span class="op">+</span> </span>
<span>                           <span class="va">rocobj</span><span class="op">$</span><span class="va">specificities</span><span class="op">)</span></span>
<span>  <span class="va">max_value_row</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">rocbj_df</span><span class="op">$</span><span class="va">value</span><span class="op">)</span> <span class="op">==</span> <span class="va">rocbj_df</span><span class="op">$</span><span class="va">value</span><span class="op">)</span></span>
<span>  <span class="va">threshold</span> <span class="op">&lt;-</span> <span class="va">rocbj_df</span><span class="op">$</span><span class="va">threshold</span><span class="op">[</span><span class="va">max_value_row</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># plot</span></span>
<span>  <span class="va">pl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">roc</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">fpr</span>, y <span class="op">=</span> <span class="va">tpr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                color <span class="op">=</span> <span class="st">"grey"</span>, linewidth <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"False Positive Rate (1 - Specificity)"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"True Positive Rate"</span>,</span>
<span>         title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"AUROC ("</span>, <span class="va">DataProf</span>, <span class="st">" Features)"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, </span>
<span>             x <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">rocbj_df</span><span class="op">$</span><span class="va">specificities</span><span class="op">[</span><span class="va">max_value_row</span><span class="op">]</span> <span class="op">+</span> <span class="fl">0.15</span>, </span>
<span>             y <span class="op">=</span> <span class="va">rocbj_df</span><span class="op">$</span><span class="va">sensitivities</span><span class="op">[</span><span class="va">max_value_row</span><span class="op">]</span> <span class="op">-</span> <span class="fl">0.05</span>, </span>
<span>             label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">threshold</span>, <span class="st">" ("</span>, </span>
<span>                            <span class="va">rocbj_df</span><span class="op">$</span><span class="va">specificities</span><span class="op">[</span><span class="va">max_value_row</span><span class="op">]</span>, <span class="st">","</span>,</span>
<span>                            <span class="va">rocbj_df</span><span class="op">$</span><span class="va">sensitivities</span><span class="op">[</span><span class="va">max_value_row</span><span class="op">]</span>, <span class="st">")"</span><span class="op">)</span>,</span>
<span>             size<span class="op">=</span><span class="fl">5</span>, family<span class="op">=</span><span class="st">"serif"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"point"</span>, </span>
<span>             x <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">rocbj_df</span><span class="op">$</span><span class="va">specificities</span><span class="op">[</span><span class="va">max_value_row</span><span class="op">]</span>, </span>
<span>             y <span class="op">=</span> <span class="va">rocbj_df</span><span class="op">$</span><span class="va">sensitivities</span><span class="op">[</span><span class="va">max_value_row</span><span class="op">]</span>, </span>
<span>             color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>    </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, </span>
<span>             x <span class="op">=</span> <span class="fl">.75</span>, y <span class="op">=</span> <span class="fl">.25</span>, </span>
<span>             label <span class="op">=</span> <span class="va">roc_CI_lab</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">5</span>, family <span class="op">=</span> <span class="st">"serif"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span>,</span>
<span>          plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>          axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>          axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>          axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.5</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>          axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">12</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>          axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>          text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span>, color <span class="op">=</span> <span class="st">"black"</span>, family <span class="op">=</span> <span class="st">"serif"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>rocobj <span class="op">=</span> <span class="va">rocobj</span>,</span>
<span>              roc_CI <span class="op">=</span> <span class="va">roc_CI_lab</span>,</span>
<span>              roc_pl <span class="op">=</span> <span class="va">pl</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">AUROC_res</span> <span class="op">&lt;-</span> <span class="fu">AUROC</span><span class="op">(</span></span>
<span>    DataTest <span class="op">=</span> <span class="va">testData</span>, </span>
<span>    PredProb <span class="op">=</span> <span class="va">pred_prob</span>, </span>
<span>    label <span class="op">=</span> <span class="va">group_names</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>    DataProf <span class="op">=</span> <span class="va">optimal</span><span class="op">)</span></span>
<span></span>
<span><span class="va">AUROC_res</span><span class="op">$</span><span class="va">roc_pl</span></span></code></pre></div>
<div class="inline-figure"><img src="70-MachineLearing_RandomForest_files/figure-html/unnamed-chunk-16-1.png" width="100%"></div>
<ul>
<li>AUPRC</li>
</ul>
<div class="sourceCode" id="cb221"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">AUPRC</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">DataTest</span>, </span>
<span>    <span class="va">PredProb</span> <span class="op">=</span> <span class="va">pred_prob</span>, </span>
<span>    <span class="va">DataProf</span> <span class="op">=</span> <span class="va">optimal</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># DataTest = testData</span></span>
<span>  <span class="co"># PredProb = pred_prob</span></span>
<span>  <span class="co"># DataProf = optimal</span></span>
<span>  </span>
<span>  <span class="co"># ROC object</span></span>
<span>  <span class="va">rocobj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span><span class="va">DataTest</span><span class="op">$</span><span class="va">Group</span>, <span class="va">PredProb</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># p-r value </span></span>
<span>  <span class="va">dat_PR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/coords.html">coords</a></span><span class="op">(</span><span class="va">rocobj</span>, <span class="st">"all"</span>, ret <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"precision"</span>, <span class="st">"recall"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># AUPRC data</span></span>
<span>  <span class="va">prc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>precision <span class="op">=</span> <span class="va">dat_PR</span><span class="op">$</span><span class="va">precision</span>,</span>
<span>                    recall <span class="op">=</span> <span class="va">dat_PR</span><span class="op">$</span><span class="va">recall</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># plot</span></span>
<span>  <span class="va">pl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">prc</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">recall</span>, y <span class="op">=</span> <span class="va">precision</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Recall"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Precision"</span>,</span>
<span>         title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"AUPRC ("</span>, <span class="va">DataProf</span>, <span class="st">" Features)"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span>,</span>
<span>          plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>          axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>          axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>          axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.5</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>          axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">12</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>          axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>          text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span>, color <span class="op">=</span> <span class="st">"black"</span>, family <span class="op">=</span> <span class="st">"serif"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>dat_PR <span class="op">=</span> <span class="va">dat_PR</span>,</span>
<span>              PC_pl <span class="op">=</span> <span class="va">pl</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">AUPRC_res</span> <span class="op">&lt;-</span> <span class="fu">AUPRC</span><span class="op">(</span></span>
<span>    DataTest <span class="op">=</span> <span class="va">testData</span>, </span>
<span>    PredProb <span class="op">=</span> <span class="va">pred_prob</span>, </span>
<span>    DataProf <span class="op">=</span> <span class="va">optimal</span><span class="op">)</span></span>
<span></span>
<span><span class="va">AUPRC_res</span><span class="op">$</span><span class="va">PC_pl</span></span></code></pre></div>
<div class="inline-figure"><img src="70-MachineLearing_RandomForest_files/figure-html/unnamed-chunk-17-1.png" width="100%"></div>
</div>
<div id="final-biomarkers" class="section level2" number="15.12">
<h2>
<span class="header-section-number">15.12</span> Final biomarkers<a class="anchor" aria-label="anchor" href="#final-biomarkers"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>importance score</li>
</ul>
<div class="sourceCode" id="cb222"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imp_biomarker</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Features</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">dat_coef</span><span class="op">$</span><span class="va">FeatureID</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Features</span>, <span class="va">MeanDecreaseAccuracy</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">MeanDecreaseAccuracy</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Features <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_inorder</a></span><span class="op">(</span><span class="va">Features</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Features</span>, y <span class="op">=</span> <span class="va">MeanDecreaseAccuracy</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, fill <span class="op">=</span> <span class="st">"white"</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Mean decrease accuracy"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="va">main_theme</span></span></code></pre></div>
<div class="inline-figure"><img src="70-MachineLearing_RandomForest_files/figure-html/unnamed-chunk-18-1.png" width="100%"></div>
</div>
<div id="systemic-information-6" class="section level2" number="15.13">
<h2>
<span class="header-section-number">15.13</span> systemic information<a class="anchor" aria-label="anchor" href="#systemic-information-6"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb223"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://r-lib.github.io/sessioninfo/reference/session_info.html">session_info</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ─ Session info ───────────────────────────────────────────</span></span>
<span><span class="co">#&gt;  setting  value</span></span>
<span><span class="co">#&gt;  version  R version 4.1.3 (2022-03-10)</span></span>
<span><span class="co">#&gt;  os       macOS Big Sur/Monterey 10.16</span></span>
<span><span class="co">#&gt;  system   x86_64, darwin17.0</span></span>
<span><span class="co">#&gt;  ui       X11</span></span>
<span><span class="co">#&gt;  language (EN)</span></span>
<span><span class="co">#&gt;  collate  en_US.UTF-8</span></span>
<span><span class="co">#&gt;  ctype    en_US.UTF-8</span></span>
<span><span class="co">#&gt;  tz       Asia/Shanghai</span></span>
<span><span class="co">#&gt;  date     2024-02-06</span></span>
<span><span class="co">#&gt;  pandoc   3.1.1 @ /Applications/RStudio.app/Contents/Resources/app/quarto/bin/tools/ (via rmarkdown)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ─ Packages ───────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;  package      * version    date (UTC) lib source</span></span>
<span><span class="co">#&gt;  backports      1.4.1      2021-12-13 [2] CRAN (R 4.1.0)</span></span>
<span><span class="co">#&gt;  base64enc      0.1-3      2015-07-28 [2] CRAN (R 4.1.0)</span></span>
<span><span class="co">#&gt;  bookdown       0.34       2023-05-09 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  bslib          0.6.0      2023-11-21 [1] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  cachem         1.0.8      2023-05-01 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  callr          3.7.3      2022-11-02 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  caret        * 6.0-94     2023-03-21 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  checkmate      2.2.0      2023-04-27 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  class          7.3-22     2023-05-03 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  cli            3.6.1      2023-03-23 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  cluster        2.1.4      2022-08-22 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  codetools      0.2-19     2023-02-01 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  colorspace     2.1-0      2023-01-23 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  crayon         1.5.2      2022-09-29 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  data.table   * 1.14.8     2023-02-17 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  devtools       2.4.5      2022-10-11 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  digest         0.6.33     2023-07-07 [1] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  downlit        0.4.3      2023-06-29 [2] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  dplyr        * 1.1.4      2023-11-17 [1] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  e1071          1.7-13     2023-02-01 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  ellipsis       0.3.2      2021-04-29 [2] CRAN (R 4.1.0)</span></span>
<span><span class="co">#&gt;  evaluate       0.21       2023-05-05 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  fansi          1.0.4      2023-01-22 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  farver         2.1.1      2022-07-06 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  fastmap        1.1.1      2023-02-24 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  forcats        1.0.0      2023-01-29 [1] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  foreach        1.5.2      2022-02-02 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  foreign        0.8-84     2022-12-06 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  Formula        1.2-5      2023-02-24 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  fs             1.6.2      2023-04-25 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  future         1.33.0     2023-07-01 [2] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  future.apply   1.11.0     2023-05-21 [2] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  generics       0.1.3      2022-07-05 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  ggplot2      * 3.4.4      2023-10-12 [1] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  globals        0.16.2     2022-11-21 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  glue           1.6.2      2022-02-24 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  gower          1.0.1      2022-12-22 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  gridExtra      2.3        2017-09-09 [2] CRAN (R 4.1.0)</span></span>
<span><span class="co">#&gt;  gtable         0.3.3      2023-03-21 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  hardhat        1.3.0      2023-03-30 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  highr          0.10       2022-12-22 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  Hmisc        * 5.1-0      2023-05-08 [1] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  htmlTable      2.4.1      2022-07-07 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  htmltools      0.5.7      2023-11-03 [1] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  htmlwidgets    1.6.2      2023-03-17 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  httpuv         1.6.11     2023-05-11 [2] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  ipred          0.9-14     2023-03-09 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  iterators      1.0.14     2022-02-05 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  jquerylib      0.1.4      2021-04-26 [2] CRAN (R 4.1.0)</span></span>
<span><span class="co">#&gt;  jsonlite       1.8.7      2023-06-29 [2] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  knitr          1.43       2023-05-25 [2] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  labeling       0.4.2      2020-10-20 [2] CRAN (R 4.1.0)</span></span>
<span><span class="co">#&gt;  later          1.3.1      2023-05-02 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  lattice      * 0.21-8     2023-04-05 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  lava           1.7.2.1    2023-02-27 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  lifecycle      1.0.3      2022-10-07 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  listenv        0.9.0      2022-12-16 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  lubridate      1.9.2      2023-02-10 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  magrittr       2.0.3      2022-03-30 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  MASS           7.3-60     2023-05-04 [1] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  Matrix         1.6-5      2024-01-11 [1] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  MatrixModels   0.5-2      2023-07-10 [2] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  memoise        2.0.1      2021-11-26 [2] CRAN (R 4.1.0)</span></span>
<span><span class="co">#&gt;  mime           0.12       2021-09-28 [2] CRAN (R 4.1.0)</span></span>
<span><span class="co">#&gt;  miniUI         0.1.1.1    2018-05-18 [2] CRAN (R 4.1.0)</span></span>
<span><span class="co">#&gt;  ModelMetrics   1.2.2.2    2020-03-17 [2] CRAN (R 4.1.0)</span></span>
<span><span class="co">#&gt;  multcomp       1.4-25     2023-06-20 [2] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  munsell        0.5.0      2018-06-12 [2] CRAN (R 4.1.0)</span></span>
<span><span class="co">#&gt;  mvtnorm        1.2-2      2023-06-08 [2] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  nlme           3.1-162    2023-01-31 [1] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  nnet           7.3-19     2023-05-03 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  parallelly     1.36.0     2023-05-26 [2] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  pillar         1.9.0      2023-03-22 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  pkgbuild       1.4.2      2023-06-26 [2] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  pkgconfig      2.0.3      2019-09-22 [2] CRAN (R 4.1.0)</span></span>
<span><span class="co">#&gt;  pkgload        1.3.2.1    2023-07-08 [2] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  plyr           1.8.8      2022-11-11 [1] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  polspline      1.1.23     2023-06-29 [1] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  prettyunits    1.1.1      2020-01-24 [2] CRAN (R 4.1.0)</span></span>
<span><span class="co">#&gt;  pROC         * 1.18.4     2023-07-06 [2] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  processx       3.8.2      2023-06-30 [2] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  prodlim        2023.03.31 2023-04-02 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  profvis        0.3.8      2023-05-02 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  promises       1.2.0.1    2021-02-11 [2] CRAN (R 4.1.0)</span></span>
<span><span class="co">#&gt;  proxy          0.4-27     2022-06-09 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  ps             1.7.5      2023-04-18 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  purrr          1.0.1      2023-01-10 [1] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  quantreg       5.95       2023-04-08 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  R6             2.5.1      2021-08-19 [2] CRAN (R 4.1.0)</span></span>
<span><span class="co">#&gt;  randomForest * 4.7-1.1    2022-05-23 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  Rcpp           1.0.11     2023-07-06 [1] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  recipes        1.0.6      2023-04-25 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  remotes        2.4.2      2021-11-30 [2] CRAN (R 4.1.0)</span></span>
<span><span class="co">#&gt;  reshape2       1.4.4      2020-04-09 [2] CRAN (R 4.1.0)</span></span>
<span><span class="co">#&gt;  rlang          1.1.1      2023-04-28 [1] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  rmarkdown      2.23       2023-07-01 [2] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  rms          * 6.7-0      2023-05-08 [1] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  rpart          4.1.19     2022-10-21 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  rstudioapi     0.15.0     2023-07-07 [2] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  sandwich       3.0-2      2022-06-15 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  sass           0.4.6      2023-05-03 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  scales         1.2.1      2022-08-20 [1] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  sessioninfo    1.2.2      2021-12-06 [2] CRAN (R 4.1.0)</span></span>
<span><span class="co">#&gt;  shiny          1.7.4.1    2023-07-06 [2] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  SparseM        1.81       2021-02-18 [2] CRAN (R 4.1.0)</span></span>
<span><span class="co">#&gt;  stringi        1.7.12     2023-01-11 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  stringr        1.5.1      2023-11-14 [1] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  survival       3.5-5      2023-03-12 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  TH.data        1.1-2      2023-04-17 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  tibble       * 3.2.1      2023-03-20 [1] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  tidyselect     1.2.0      2022-10-10 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  timechange     0.2.0      2023-01-11 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  timeDate       4022.108   2023-01-07 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  urlchecker     1.0.1      2021-11-30 [2] CRAN (R 4.1.0)</span></span>
<span><span class="co">#&gt;  usethis        2.2.2      2023-07-06 [2] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  utf8           1.2.3      2023-01-31 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  vctrs          0.6.5      2023-12-01 [1] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  withr          2.5.0      2022-03-03 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  xfun           0.40       2023-08-09 [1] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  xml2           1.3.5      2023-07-06 [2] CRAN (R 4.1.3)</span></span>
<span><span class="co">#&gt;  xtable         1.8-4      2019-04-21 [2] CRAN (R 4.1.0)</span></span>
<span><span class="co">#&gt;  yaml           2.3.7      2023-01-23 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt;  zoo            1.8-12     2023-04-13 [2] CRAN (R 4.1.2)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  [1] /Users/zouhua/Library/R/x86_64/4.1/library</span></span>
<span><span class="co">#&gt;  [2] /Library/Frameworks/R.framework/Versions/4.1/Resources/library</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ──────────────────────────────────────────────────────────</span></span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="OtherAnalysis.html"><span class="header-section-number">14</span> Other Analysis</a></div>
<div class="next"><a href="XGBoostalgorithm.html"><span class="header-section-number">16</span> XGBoost Algorithm</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#randomforestalgorithm"><span class="header-section-number">15</span> Random Forest Algorithm</a></li>
<li><a class="nav-link" href="#%E4%B8%8B%E8%BD%BD%E6%95%B0%E6%8D%AE"><span class="header-section-number">15.1</span> 下载数据</a></li>
<li><a class="nav-link" href="#%E5%8A%A0%E8%BD%BDr%E5%8C%85-12"><span class="header-section-number">15.2</span> 加载R包</a></li>
<li><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE"><span class="header-section-number">15.3</span> 加载数据</a></li>
<li><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%88%87%E5%89%B2"><span class="header-section-number">15.4</span> 数据切割</a></li>
<li><a class="nav-link" href="#%E8%B0%83%E5%8F%82%E9%80%89%E6%8B%A9%E6%9C%80%E4%BD%B3%E5%86%B3%E7%AD%96%E6%A0%91%E6%95%B0%E7%9B%AE"><span class="header-section-number">15.5</span> 调参（选择最佳决策树数目）</a></li>
<li><a class="nav-link" href="#%E5%BB%BA%E6%A8%A1"><span class="header-section-number">15.6</span> 建模</a></li>
<li><a class="nav-link" href="#%E7%89%B9%E5%BE%81%E7%9A%84%E9%87%8D%E8%A6%81%E6%80%A7%E5%BE%97%E5%88%86"><span class="header-section-number">15.7</span> 特征的重要性得分</a></li>
<li><a class="nav-link" href="#%E5%A4%9A%E6%AC%A1%E5%BB%BA%E6%A8%A1%E9%80%89%E6%8B%A9%E6%9C%80%E4%BD%B3%E7%89%B9%E5%BE%81%E6%95%B0%E7%9B%AE%E5%9F%BA%E4%BA%8Eoob-rate"><span class="header-section-number">15.8</span> 多次建模选择最佳特征数目（基于OOB rate）</a></li>
<li><a class="nav-link" href="#%E5%A4%9A%E5%85%83%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90%E7%AD%9B%E9%80%89%E7%9B%B8%E5%85%B3%E7%89%B9%E5%BE%81"><span class="header-section-number">15.9</span> 多元回归分析筛选相关特征</a></li>
<li><a class="nav-link" href="#%E7%96%BE%E7%97%85%E9%A3%8E%E9%99%A9%E5%BE%97%E5%88%86"><span class="header-section-number">15.10</span> 疾病风险得分</a></li>
<li><a class="nav-link" href="#%E9%87%8D%E6%96%B0%E5%BB%BA%E6%A8%A1"><span class="header-section-number">15.11</span> 重新建模</a></li>
<li><a class="nav-link" href="#final-biomarkers"><span class="header-section-number">15.12</span> Final biomarkers</a></li>
<li><a class="nav-link" href="#systemic-information-6"><span class="header-section-number">15.13</span> systemic information</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/HuaZou/DraftNotes/blob/main/70-MachineLearing_RandomForest.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/HuaZou/DraftNotes/edit/main/70-MachineLearing_RandomForest.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>生物信息随记</strong>" was written by Hua Zou. It was last built on 2023-08-24 and updated on 2024-02-06.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
